"use client";
import * as React from "react";
import "./globals.css";
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import { Amplify } from "aws-amplify";
import { awsConfig } from "@/aws-exports";
import { useAuth } from "@/hooks/useAuth";
import { useRouter } from "next/router";

const inter = Inter({ subsets: ["latin"] });

const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

function RootLayout({ children }: { children: React.ReactNode }) {
  const { user, customState, getUser } = useAuth();
  React.useEffect(() => {
    if (typeof window !== "undefined") {
      // Only access window when running on the client side
      const isLocalhost =
        window.location.hostname === "localhost" ||
        window.location.hostname === "[::1]" ||
        window.location.hostname.match(
          /^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/
        );

      const [localRedirectSignIn, productionRedirectSignIn] =
        awsConfig.oauth.redirectSignIn;

      console.log(productionRedirectSignIn);
      const [localRedirectSignOut, productionRedirectSignOut] =
        awsConfig.oauth.redirectSignOut;
      console.log(productionRedirectSignOut);

      const updatedAwsConfig = {
        ...awsConfig,
        oauth: {
          ...awsConfig.oauth,
          redirectSignIn: isLocalhost
            ? localRedirectSignIn
            : productionRedirectSignIn,
          redirectSignOut: isLocalhost
            ? localRedirectSignOut
            : productionRedirectSignOut,
        },
      };

      console.log(updatedAwsConfig);
      Amplify.configure(updatedAwsConfig);
    }

    getUser();
  }, []);

  console.log(user);
  return (
    <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
  );
}

export default RootLayout;
